import{c as t,g as o}from"../@amap/@amap.09f500c0.js";var n={exports:{}};const r=o(n.exports=function(){function t(n,r,e,i,s,a){if(!(s-i<=e)){var p=i+s>>1;o(n,r,p,i,s,a%2),t(n,r,e,i,p-1,a+1),t(n,r,e,p+1,s,a+1)}}function o(t,r,e,i,s,a){for(;s>i;){if(s-i>600){var p=s-i+1,h=e-i+1,u=Math.log(p),f=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*f*(p-f)/p)*(h-p/2<0?-1:1);o(t,r,e,Math.max(i,Math.floor(e-h*f/p+d)),Math.min(s,Math.floor(e+(p-h)*f/p+d)),a)}var l=r[2*e+a],m=i,c=s;for(n(t,r,i,e),r[2*s+a]>l&&n(t,r,i,s);m<c;){for(n(t,r,m,c),m++,c--;r[2*m+a]<l;)m++;for(;r[2*c+a]>l;)c--}r[2*i+a]===l?n(t,r,i,c):n(t,r,++c,s),c<=e&&(i=c+1),e<=c&&(s=c-1)}}function n(t,o,n,e){r(t,n,e),r(o,2*n,2*e),r(o,2*n+1,2*e+1)}function r(t,o,n){var r=t[o];t[o]=t[n],t[n]=r}function e(t,o,n,r,e,i,s){for(var a,p,h=[0,t.length-1,0],u=[];h.length;){var f=h.pop(),d=h.pop(),l=h.pop();if(d-l<=s)for(var m=l;m<=d;m++)a=o[2*m],p=o[2*m+1],a>=n&&a<=e&&p>=r&&p<=i&&u.push(t[m]);else{var c=Math.floor((l+d)/2);a=o[2*c],p=o[2*c+1],a>=n&&a<=e&&p>=r&&p<=i&&u.push(t[c]);var v=(f+1)%2;(0===f?n<=a:r<=p)&&(h.push(l),h.push(c-1),h.push(v)),(0===f?e>=a:i>=p)&&(h.push(c+1),h.push(d),h.push(v))}}return u}function i(t,o,n,r,e,i){for(var a=[0,t.length-1,0],p=[],h=e*e;a.length;){var u=a.pop(),f=a.pop(),d=a.pop();if(f-d<=i)for(var l=d;l<=f;l++)s(o[2*l],o[2*l+1],n,r)<=h&&p.push(t[l]);else{var m=Math.floor((d+f)/2),c=o[2*m],v=o[2*m+1];s(c,v,n,r)<=h&&p.push(t[m]);var g=(u+1)%2;(0===u?n-e<=c:r-e<=v)&&(a.push(d),a.push(m-1),a.push(g)),(0===u?n+e>=c:r+e>=v)&&(a.push(m+1),a.push(f),a.push(g))}}return p}function s(t,o,n,r){var e=t-n,i=o-r;return e*e+i*i}var a=function(t){return t[0]},p=function(t){return t[1]},h=function(o,n,r,e,i){void 0===n&&(n=a),void 0===r&&(r=p),void 0===e&&(e=64),void 0===i&&(i=Float64Array),this.nodeSize=e,this.points=o;for(var s=o.length<65536?Uint16Array:Uint32Array,h=this.ids=new s(o.length),u=this.coords=new i(2*o.length),f=0;f<o.length;f++)h[f]=f,u[2*f]=n(o[f]),u[2*f+1]=r(o[f]);t(h,u,e,0,h.length-1,0)};h.prototype.range=function(t,o,n,r){return e(this.ids,this.coords,t,o,n,r,this.nodeSize)},h.prototype.within=function(t,o,n){return i(this.ids,this.coords,t,o,n,this.nodeSize)};var u,f={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},d=Math.fround||(u=new Float32Array(1),function(t){return u[0]=+t,u[0]}),l=function(t){this.options=w(Object.create(f),t),this.trees=new Array(this.options.maxZoom+1)};function m(t,o,n,r,e){return{x:d(t),y:d(o),zoom:Infinity,id:n,parentId:-1,numPoints:r,properties:e}}function c(t,o){var n=t.geometry.coordinates,r=n[0],e=n[1];return{x:d(y(r)),y:d(x(e)),zoom:Infinity,index:o,parentId:-1}}function v(t){return{type:"Feature",id:t.id,properties:g(t),geometry:{type:"Point",coordinates:[M(t.x),_(t.y)]}}}function g(t){var o=t.numPoints,n=o>=1e4?Math.round(o/1e3)+"k":o>=1e3?Math.round(o/100)/10+"k":o;return w(w({},t.properties),{cluster:!0,cluster_id:t.id,point_count:o,point_count_abbreviated:n})}function y(t){return t/360+.5}function x(t){var o=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+o)/(1-o))/Math.PI;return n<0?0:n>1?1:n}function M(t){return 360*(t-.5)}function _(t){var o=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(o))/Math.PI-90}function w(t,o){for(var n in o)t[n]=o[n];return t}function P(t){return t.x}function I(t){return t.y}return l.prototype.load=function(t){var o=this.options,n=o.log,r=o.minZoom,e=o.maxZoom,i=o.nodeSize;n&&console.time("total time");var s="prepare "+t.length+" points";n&&console.time(s),this.points=t;for(var a=[],p=0;p<t.length;p++)t[p].geometry&&a.push(c(t[p],p));this.trees[e+1]=new h(a,P,I,i,Float32Array),n&&console.timeEnd(s);for(var u=e;u>=r;u--)Date.now(),a=this._cluster(a,u),this.trees[u]=new h(a,P,I,i,Float32Array),n&&(a.length,Date.now());return n&&console.timeEnd("total time"),this},l.prototype.getClusters=function(t,o){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),e=180===t[2]?180:((t[2]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,e=180;else if(n>e){var s=this.getClusters([n,r,180,i],o),a=this.getClusters([-180,r,e,i],o);return s.concat(a)}for(var p=this.trees[this._limitZoom(o)],h=[],u=0,f=p.range(y(n),x(i),y(e),x(r));u<f.length;u+=1){var d=f[u],l=p.points[d];h.push(l.numPoints?v(l):this.points[l.index])}return h},l.prototype.getChildren=function(t){var o=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",e=this.trees[n];if(!e)throw new Error(r);var i=e.points[o];if(!i)throw new Error(r);for(var s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=[],p=0,h=e.within(i.x,i.y,s);p<h.length;p+=1){var u=h[p],f=e.points[u];f.parentId===t&&a.push(f.numPoints?v(f):this.points[f.index])}if(0===a.length)throw new Error(r);return a},l.prototype.getLeaves=function(t,o,n){o=o||10,n=n||0;var r=[];return this._appendLeaves(r,t,o,n,0),r},l.prototype.getTile=function(t,o,n){var r=this.trees[this._limitZoom(t)],e=Math.pow(2,t),i=this.options,s=i.extent,a=i.radius/s,p=(n-a)/e,h=(n+1+a)/e,u={features:[]};return this._addTileFeatures(r.range((o-a)/e,p,(o+1+a)/e,h),r.points,o,n,e,u),0===o&&this._addTileFeatures(r.range(1-a/e,p,1,h),r.points,e,n,e,u),o===e-1&&this._addTileFeatures(r.range(0,p,a/e,h),r.points,-1,n,e,u),u.features.length?u:null},l.prototype.getClusterExpansionZoom=function(t){for(var o=this._getOriginZoom(t)-1;o<=this.options.maxZoom;){var n=this.getChildren(t);if(o++,1!==n.length)break;t=n[0].properties.cluster_id}return o},l.prototype._appendLeaves=function(t,o,n,r,e){for(var i=0,s=this.getChildren(o);i<s.length;i+=1){var a=s[i],p=a.properties;if(p&&p.cluster?e+p.point_count<=r?e+=p.point_count:e=this._appendLeaves(t,p.cluster_id,n,r,e):e<r?e++:t.push(a),t.length===n)break}return e},l.prototype._addTileFeatures=function(t,o,n,r,e,i){for(var s=0,a=t;s<a.length;s+=1){var p=o[a[s]],h=p.numPoints,u=void 0,f=void 0,d=void 0;if(h)u=g(p),f=p.x,d=p.y;else{var l=this.points[p.index];u=l.properties,f=y(l.geometry.coordinates[0]),d=x(l.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(f*e-n)),Math.round(this.options.extent*(d*e-r))]],tags:u},c=void 0;h?c=p.id:this.options.generateId?c=p.index:this.points[p.index].id&&(c=this.points[p.index].id),void 0!==c&&(m.id=c),i.features.push(m)}},l.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},l.prototype._cluster=function(t,o){for(var n=[],r=this.options,e=r.radius,i=r.extent,s=r.reduce,a=r.minPoints,p=e/(i*Math.pow(2,o)),h=0;h<t.length;h++){var u=t[h];if(!(u.zoom<=o)){u.zoom=o;for(var f=this.trees[o+1],d=f.within(u.x,u.y,p),l=u.numPoints||1,c=l,v=0,g=d;v<g.length;v+=1){var y=g[v],x=f.points[y];x.zoom>o&&(c+=x.numPoints||1)}if(c>l&&c>=a){for(var M=u.x*l,_=u.y*l,w=s&&l>1?this._map(u,!0):null,P=(h<<5)+(o+1)+this.points.length,I=0,Z=d;I<Z.length;I+=1){var z=Z[I],F=f.points[z];if(!(F.zoom<=o)){F.zoom=o;var A=F.numPoints||1;M+=F.x*A,_+=F.y*A,F.parentId=P,s&&(w||(w=this._map(u,!0)),s(w,this._map(F)))}}u.parentId=P,n.push(m(M/c,_/c,P,c,w))}else if(n.push(u),c>1)for(var C=0,E=d;C<E.length;C+=1){var O=E[C],S=f.points[O];S.zoom<=o||(S.zoom=o,n.push(S))}}}return n},l.prototype._getOriginId=function(t){return t-this.points.length>>5},l.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},l.prototype._map=function(t,o){if(t.numPoints)return o?w({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return o&&r===n?w({},r):r},l}());export{r as S};
